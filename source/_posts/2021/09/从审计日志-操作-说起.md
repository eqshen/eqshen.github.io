---
title: 从审计日志(操作)说起
date: 2021-09-21 12:42:08
tags:
---


### 从审计日志(操作)说起

时隔一年，偷懒了一年，再次开始写日志，补补技术债

#### 背景
在公司日常的开发中，经常会遇到记录操作（审计）日志的情况，格式像这样：`法外狂人张三 修改了 xxx配置，从 123 修改为 456`。如果一个项目中crud的接口比较少，那我们完全可以在 接口中硬编码，这中方式也是最直接最快的方式，但是对于一个追求完美的“技术癖”来说，还是存在以下担忧的地方

- 接口可能不是同一个人开发，日志的格式如何统一？模板方法？
- 后续修改，每个地方都要修改，工作量就比较大，不好维护
- 通用逻辑植入业务代码，很不爽
- 每个接口入参和出参格式不一样，如何从中提取参数信息？

##### 具体需求举例
各个业务需要统一将操作日志记录并统一上报，上报的报文要包含以下内容：
- 


#### 常见的解决方案
1. 从数据层面入手，订阅数据库Binlog
    简单来说，就是通过Canal订阅MySQL的binlog, 这样每次就能知道哪张表、哪行被修改了。
    - 好处：直接和业务逻辑解耦
    - 缺点：复杂的业务逻辑无法表现出来，如果一个接口中修改了很多接口，甚至还有RPC调用，这种情况下就不太实用这种方案了。

2. 定义类似LogUtil一样的工具类，抽象入参，在工具类中实现模板化，在需要记录日志的地方调用工具类
    这种方式也是比较容易想到，而且是比较简单的实现。

3. 自定义注解 + Aop + SpEL实现解耦
